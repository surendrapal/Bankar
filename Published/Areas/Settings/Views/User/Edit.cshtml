@model PharmaReport.Models.UserProfile
@section TitleSection{ Update User Details }
<ul id="crumbs">
    <li>@Html.ActionLink("Home", "Index", "Account") </li>
    <li>@Html.ActionLink("Manage Users", "Index", "User") </li>
    <li>Update User Details</li>
</ul>
<div class="contentWrapper">
    <div class="full-page-form  formdetails">
        @ViewBag.Message
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(false)
              <div class="editor-field">
                @Html.HiddenFor(model => model.UserName)
                @Html.LabelFor(model => model.FirstName)
                @Html.EditorFor(model => model.FirstName)
            </div>

            <div class="editor-field">
                @Html.LabelFor(model => model.LastName)
                @Html.EditorFor(model => model.LastName)
            </div>
            <div class="clear"></div>
            <div class="editor-field">
                @Html.LabelFor(model => model.Email)
                @Html.EditorFor(model => model.Email)    
                @Html.ValidationMessageFor(model => model.Email)
            </div>
            <div class="editor-field">
                @Html.LabelFor(model => model.CityId)
                <input type="text" value="" id="CityName" data-val-required="Location is required." data-val="true" class="text-box single-line" >
                @Html.HiddenFor(model => model.CityId)
            </div>

            <div class="clear"></div>
            <div class="editor-field">
                @Html.LabelFor(model => model.Specialty)
            <table style="width: 100%">
                <tr>
                     @{
            int cnt = 0;
            List<PharmaReport.Models.AssignedSpecialties> AssignedSpecialties = ViewBag.AssignedSpecialties;
            foreach (var specialty in AssignedSpecialties)
            {
                if (cnt++ % 6 == 0)
                {
                                    @:  </tr> <tr> 
                                    }
                                    @: <td> 
                                        <input type="checkbox" 
                                               name="selectedSpecialty" 
                                               value="@specialty.SpecialtyId"
                                             @(Html.Raw(specialty.Assigned ? "checked=\"checked\"" : "")) /> 
                                        @specialty.Name
                                    @:</td>
                                }
                                @: </tr>
                    }
            </table>
        </div>          
            <div class="clear"></div>
            <p>
                <input type="submit" class="submit" value="Update" />
                @Html.ActionLink("Back", "Index", null, new { @class = "submit" })
            </p>
        }

    </div>
</div>
<script type="text/javascript">      
   

    $(function () {
        $("#CityName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/admin/location/LookupCity", type: "POST", dataType: "json",
                    data: { id: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { label: item.Name, value: item.Name, id: item.Id }
                        }))
                    }
                })
            },
            select: function (event, ui) {
                $("#CityId").val(ui.item.id);

            }
        })
    });
    $(document).ready(function () {

        var btn = $("input[type='submit']");
        $('input', 'form').blur(function () {
            $(this).valid();
            if ($(this).attr('id') == "CityName") {
                if ($(this).val() == '') {
                    $(this).addClass("input-validation-error");
                    btn.attr("disabled", "disabled");
                    //alert('');
                }
                else {
                    btn.removeAttr("disabled");
                    $(this).removeClass("input-validation-error");
                }
            }
        });
        $.ajax({
            url: "/admin/location/LookupCityById/" + $("#CityId").val(), type: "POST", dataType: "json",
            data: {},
            success: function (data) {
                $.map(data, function (item) {
                    $("#CityName").val(item.Name);
                });
            }
        });
    });
</script>
